<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Web Player Kernel | Studios</title><meta name="description" content="">
    <link rel="preload" href="/2023/assets/style-af81738b.css" as="style"><link rel="stylesheet" href="/2023/assets/style-af81738b.css">
    <link rel="modulepreload" href="/2023/assets/app-8d1f7407.js"><link rel="modulepreload" href="/2023/assets/framework-5866ffd3.js"><link rel="modulepreload" href="/2023/assets/webPlayerKernel.html-f0775f0d.js"><link rel="modulepreload" href="/2023/assets/webPlayerKernel.html-adf32b57.js"><link rel="prefetch" href="/2023/assets/index.html-7f7a0c3f.js" as="script"><link rel="prefetch" href="/2023/assets/Reference.html-62bf0884.js" as="script"><link rel="prefetch" href="/2023/assets/express.js.html-57e95e66.js" as="script"><link rel="prefetch" href="/2023/assets/koa.js.html-139b5782.js" as="script"><link rel="prefetch" href="/2023/assets/next.js.html-5c76bb25.js" as="script"><link rel="prefetch" href="/2023/assets/node.js.html-9a866051.js" as="script"><link rel="prefetch" href="/2023/assets/socket.io.html-1f3cfc7f.js" as="script"><link rel="prefetch" href="/2023/assets/cbplayer.html-9706f7fe.js" as="script"><link rel="prefetch" href="/2023/assets/clappr.html-aaf6c260.js" as="script"><link rel="prefetch" href="/2023/assets/dplayer.html-c965bdc3.js" as="script"><link rel="prefetch" href="/2023/assets/plyr.html-1e89d56a.js" as="script"><link rel="prefetch" href="/2023/assets/video.js.html-0bf587fd.js" as="script"><link rel="prefetch" href="/2023/assets/xgplayer.html-6f0838b2.js" as="script"><link rel="prefetch" href="/2023/assets/hls.js.html-6ae3bfa5.js" as="script"><link rel="prefetch" href="/2023/assets/playwright.html-baa3b880.js" as="script"><link rel="prefetch" href="/2023/assets/puppeteer.html-700e8b32.js" as="script"><link rel="prefetch" href="/2023/assets/testCafe.html-88b7ea79.js" as="script"><link rel="prefetch" href="/2023/assets/docker.html-1a1f0c5f.js" as="script"><link rel="prefetch" href="/2023/assets/elastic.html-a21aaf45.js" as="script"><link rel="prefetch" href="/2023/assets/grafana.html-ada9ede2.js" as="script"><link rel="prefetch" href="/2023/assets/jenkins.html-7fa480b2.js" as="script"><link rel="prefetch" href="/2023/assets/nginx.html-226d46f4.js" as="script"><link rel="prefetch" href="/2023/assets/redis.html-2e066c5a.js" as="script"><link rel="prefetch" href="/2023/assets/ts.html-7a3e86a4.js" as="script"><link rel="prefetch" href="/2023/assets/webAssembly.html-e951b9a5.js" as="script"><link rel="prefetch" href="/2023/assets/webAssemblyStepByStep.html-fb9c99b9.js" as="script"><link rel="prefetch" href="/2023/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/2023/assets/index.html-9285cfdf.js" as="script"><link rel="prefetch" href="/2023/assets/Reference.html-e815d83b.js" as="script"><link rel="prefetch" href="/2023/assets/express.js.html-21fb61b3.js" as="script"><link rel="prefetch" href="/2023/assets/koa.js.html-fcee0a7c.js" as="script"><link rel="prefetch" href="/2023/assets/next.js.html-a35fdb2b.js" as="script"><link rel="prefetch" href="/2023/assets/node.js.html-63e986b8.js" as="script"><link rel="prefetch" href="/2023/assets/socket.io.html-554ed8f3.js" as="script"><link rel="prefetch" href="/2023/assets/cbplayer.html-607c8d40.js" as="script"><link rel="prefetch" href="/2023/assets/clappr.html-44b7cafb.js" as="script"><link rel="prefetch" href="/2023/assets/dplayer.html-89edbe09.js" as="script"><link rel="prefetch" href="/2023/assets/plyr.html-dbcaa34c.js" as="script"><link rel="prefetch" href="/2023/assets/video.js.html-45836c46.js" as="script"><link rel="prefetch" href="/2023/assets/xgplayer.html-82cefeff.js" as="script"><link rel="prefetch" href="/2023/assets/hls.js.html-c6f46c8b.js" as="script"><link rel="prefetch" href="/2023/assets/playwright.html-66476130.js" as="script"><link rel="prefetch" href="/2023/assets/puppeteer.html-65f9d9ed.js" as="script"><link rel="prefetch" href="/2023/assets/testCafe.html-71bdf01f.js" as="script"><link rel="prefetch" href="/2023/assets/docker.html-5300e7ed.js" as="script"><link rel="prefetch" href="/2023/assets/elastic.html-9025cfbb.js" as="script"><link rel="prefetch" href="/2023/assets/grafana.html-81c7bec7.js" as="script"><link rel="prefetch" href="/2023/assets/jenkins.html-905e298a.js" as="script"><link rel="prefetch" href="/2023/assets/nginx.html-f723be8f.js" as="script"><link rel="prefetch" href="/2023/assets/redis.html-2f01ca07.js" as="script"><link rel="prefetch" href="/2023/assets/ts.html-164efd40.js" as="script"><link rel="prefetch" href="/2023/assets/webAssembly.html-85f18239.js" as="script"><link rel="prefetch" href="/2023/assets/webAssemblyStepByStep.html-31736f20.js" as="script"><link rel="prefetch" href="/2023/assets/404.html-87d54bd8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/2023/" class=""><!----><span class="site-name">Studios</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">WebAssembly + FFmpeg <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/2023/webAssembly/webAssembly.html" class="sidebar-item" aria-label="WebAssembly"><!--[--><!--]--> WebAssembly <!--[--><!--]--></a><!----></li><li><a href="/2023/webAssembly/webAssemblyStepByStep.html" class="sidebar-item" aria-label="WebAssembly step-by-step"><!--[--><!--]--> WebAssembly step-by-step <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Web Player Kernel"><!--[--><!--]--> Web Player Kernel <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#introduction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#multimedia-file" class="router-link-active router-link-exact-active sidebar-item" aria-label="Multimedia File"><!--[--><!--]--> Multimedia File <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#hls-demux" class="router-link-active router-link-exact-active sidebar-item" aria-label="HLS Demux"><!--[--><!--]--> HLS Demux <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#video-decoding" class="router-link-active router-link-exact-active sidebar-item" aria-label="Video Decoding"><!--[--><!--]--> Video Decoding <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#video-rendering" class="router-link-active router-link-exact-active sidebar-item" aria-label="Video Rendering"><!--[--><!--]--> Video Rendering <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#development-environment" class="router-link-active router-link-exact-active sidebar-item" aria-label="Development Environment"><!--[--><!--]--> Development Environment <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#emscription" class="router-link-active router-link-exact-active sidebar-item" aria-label="Emscription"><!--[--><!--]--> Emscription <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#asm-js" class="router-link-active router-link-exact-active sidebar-item" aria-label="ASM.js"><!--[--><!--]--> ASM.js <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#webassembly-vs-asm-js" class="router-link-active router-link-exact-active sidebar-item" aria-label="WebAssembly vs ASM.js"><!--[--><!--]--> WebAssembly vs ASM.js <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#compilation-tool" class="router-link-active router-link-exact-active sidebar-item" aria-label="Compilation Tool"><!--[--><!--]--> Compilation Tool <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/2023/webAssembly/webPlayerKernel.html#source-code" class="router-link-active router-link-exact-active sidebar-item" aria-label="Source Code"><!--[--><!--]--> Source Code <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/2023/webAssembly/ts.html" class="sidebar-item" aria-label="TS (Transport Stream)"><!--[--><!--]--> TS (Transport Stream) <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Node <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/2023/node/node.js.md" class="sidebar-item" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a><!----></li><li><a href="/2023/node/express.js.md" class="sidebar-item" aria-label="Express.js"><!--[--><!--]--> Express.js <!--[--><!--]--></a><!----></li><li><a href="/2023/node/koa.js.md" class="sidebar-item" aria-label="Koa.js"><!--[--><!--]--> Koa.js <!--[--><!--]--></a><!----></li><li><a href="/2023/node/next.js.md" class="sidebar-item" aria-label="Next.js"><!--[--><!--]--> Next.js <!--[--><!--]--></a><!----></li><li><a href="/2023/node/socket.io.md" class="sidebar-item" aria-label="Socket.io"><!--[--><!--]--> Socket.io <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">HLS <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/2023/hls/hls.js.md" class="sidebar-item" aria-label="Hls.js"><!--[--><!--]--> Hls.js <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Player <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/2023/player/video.js.md" class="sidebar-item" aria-label="Video.js"><!--[--><!--]--> Video.js <!--[--><!--]--></a><!----></li><li><a href="/2023/player/xgplayer.md" class="sidebar-item" aria-label="Xgplayer"><!--[--><!--]--> Xgplayer <!--[--><!--]--></a><!----></li><li><a href="/2023/player/plyr.md" class="sidebar-item" aria-label="Plyr"><!--[--><!--]--> Plyr <!--[--><!--]--></a><!----></li><li><a href="/2023/player/clappr.md" class="sidebar-item" aria-label="Clappr"><!--[--><!--]--> Clappr <!--[--><!--]--></a><!----></li><li><a href="/2023/player/dplayer.md" class="sidebar-item" aria-label="DPlayer"><!--[--><!--]--> DPlayer <!--[--><!--]--></a><!----></li><li><a href="/2023/player/cbplayer.md" class="sidebar-item" aria-label="CBPlayer"><!--[--><!--]--> CBPlayer <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Testing <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/2023/testing/playwright.md" class="sidebar-item" aria-label="Playwright"><!--[--><!--]--> Playwright <!--[--><!--]--></a><!----></li><li><a href="/2023/testing/puppeteer.md" class="sidebar-item" aria-label="Puppeteer"><!--[--><!--]--> Puppeteer <!--[--><!--]--></a><!----></li><li><a href="/2023/testing/testCafe.md" class="sidebar-item" aria-label="TestCafe"><!--[--><!--]--> TestCafe <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">DevOps <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/2023/devops/nginx.md" class="sidebar-item" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a><!----></li><li><a href="/2023/devops/docker.md" class="sidebar-item" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a><!----></li><li><a href="/2023/devops/redis.md" class="sidebar-item" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a><!----></li><li><a href="/2023/devops/elastic.md" class="sidebar-item" aria-label="Elastic"><!--[--><!--]--> Elastic <!--[--><!--]--></a><!----></li><li><a href="/2023/devops/grafana.md" class="sidebar-item" aria-label="Grafana"><!--[--><!--]--> Grafana <!--[--><!--]--></a><!----></li><li><a href="/2023/devops/jenkins.md" class="sidebar-item" aria-label="Jenkins"><!--[--><!--]--> Jenkins <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/2023/Reference.html" class="sidebar-item sidebar-heading" aria-label="Reference"><!--[--><!--]--> Reference <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="web-player-kernel" tabindex="-1"><a class="header-anchor" href="#web-player-kernel" aria-hidden="true">#</a> Web Player Kernel</h1><h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h2><p><strong>Web Player Kernel</strong> is a core component or framework of a web-based media player that manages the core playback functionality, such as decoding audio and video streams, buffering, and synchronization.</p><p><strong>Web Player Kernel</strong> is responsible for handling the low-level details of media playback, such as handling different codecs, formats, and bitrates, and providing a smooth playback experience for the user.</p><p><strong>Web Player Kernel</strong> can be implemented using various web technologies such as JavaScript, HTML, and CSS, and can utilize specialized libraries and APIs for media playback.</p><p>The specific implementation of <strong>Web Player Kernel</strong> may depend on the platform, browser, or requirements of the application or website where the player is being used.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>There are Four Steps: Multimedia File &gt; HLS Demux &gt; Video Decoding &gt; Video Rendering</p></div><h2 id="multimedia-file" tabindex="-1"><a class="header-anchor" href="#multimedia-file" aria-hidden="true">#</a> Multimedia File</h2><p>HTTP Live Streaming (HLS) is a streaming media protocol developed by Apple Inc. For delivering audio and video content over the internet. It works by breaking the content into small segments and then delivering these segments to the client device via HTTP (Hypertext Transfer Protocol) connections.</p><p>HLS is designed to work with multiple bitrates and resolutions of a video or audio stream. It allows for adaptive streaming, where the client device can dynamically switch between different quality levels based on available network <code>bandwidth</code> and <code>CPU power</code>. This provides a seamless streaming experience for the viewer without buffering or interruption.</p><p>HLS supports various audio and video codecs, including H.264, AAC, and MP3, and can be used to stream live events as well as pre-recorded content. It also provides support for Digital Rights Management (DRM) systems to protect copyrighted content.</p><p>HLS is widely adopted by streaming media providers and is supported by various devices and platforms, including iOS and Android devices, web browsers, and smart TVs.</p><h4 id="when-using-the-hls-protocol-two-types-of-files-are-generated-m3u8-and-ts" tabindex="-1"><a class="header-anchor" href="#when-using-the-hls-protocol-two-types-of-files-are-generated-m3u8-and-ts" aria-hidden="true">#</a> When using the HLS protocol, two types of files are generated: <strong>.m3u8</strong> and <strong>.ts</strong></h4><p>The .m3u8 file is the playlist file that contains a list of URLs for the media segments in the HLS stream. It is a text file that specifies the format of the media stream, the bitrates available, and the URLs for the media segments. The .m3u8 file is used by the client device to request and play the media segments.</p><p>Here is an example of an M3U8 file:</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#EXTM3U</span>
<span class="token comment">#EXT-X-VERSION:3          // Version Info</span>
<span class="token comment">#EXT-X-TARGETDUARTION:11  // Target Duration for each Fragment</span>
<span class="token comment">#EXT-X-MEDIA-SEQUENCE:0   // Start Number of Fragment</span>
<span class="token comment">#EXTINF:10.922578         // Actual Duration of Fragment 1st</span>
index000.ts               // Fragment 1st
<span class="token comment">#EXTINF:9.929578          // Actual Duration of Fragment 2nd</span>
index001.ts               // Fragment 2nd
</code></pre></div><p>The <strong>.ts</strong> files, <strong>Transport Stream (TS)</strong> packets, are the media segments themselves. Each TS packet is typically <code>188</code> bytes long and consists of a <code>header</code> followed by <code>payload</code> data.</p><p>The header contains information such as the packet identifier, the type of data in the packet (audio, video, etc.), and timing information. The payload contains the actual audio or video data.</p><p>The TS packets are generated by a video encoder or transcoding software, and are then packaged into segments by a streaming server. These segments are typically <code>2-10</code> seconds long and are stored as individual files on the server.</p><p>During HLS streaming:</p><ul><li><p>the server will continuously generate .ts files and update the .m3u8 playlist file with the URLs of the new media segments.</p></li><li><p>when the client device requests the media stream, it will download the .m3u8 playlist file and begin requesting the TS segment files. As it receives the TS packets, it will decode and play the audio or video content.</p></li></ul><p>The use of TS packets in HLS allows for efficient and reliable streaming over the internet, as the segments can be easily cached and delivered via standard web protocols. It also enables adaptive bitrate streaming, where the client device can switch between different quality levels based on the available <strong>Network Bandwidth</strong> and <strong>Device Capabilities</strong>.</p><h2 id="hls-demux" tabindex="-1"><a class="header-anchor" href="#hls-demux" aria-hidden="true">#</a> HLS Demux</h2><p>HLS demuxer refers to the process of separating the audio and video data from an HTTP Live Streaming (HLS) stream. This is typically done on the client-side by software called an HLS demuxer or demultiplexer.</p><ul><li><p>The demuxer reads the TS packets from the downloaded segment files and separates them into audio and video data streams.</p></li><li><p>The demuxer also handles issues such as buffering, seeking, and changing bitrates as the player requests different segments.</p></li></ul><p>Overall, the HLS demux process is a critical component of delivering <strong>high-quality</strong> streaming media over the internet, as it allows for efficient delivery and playback of audio and video data.</p><h2 id="video-decoding" tabindex="-1"><a class="header-anchor" href="#video-decoding" aria-hidden="true">#</a> Video Decoding</h2><p>Video decoding using FFmpeg is converting a compressed video format to an uncompressed or raw video format that can be displayed or further processed by other software or tools. FFmpeg supports a wide range of video formats and codecs such as <strong>H.264</strong>, <strong>H.265 (HEVC)</strong>, <strong>VP8</strong>, <strong>VP9</strong>, <strong>AV1</strong> and so on, making it becomes a powerful and versatile tool for video decoding.</p><h2 id="video-rendering" tabindex="-1"><a class="header-anchor" href="#video-rendering" aria-hidden="true">#</a> Video Rendering</h2><p><strong>YUV</strong> data decoded by FFmpeg cannot be directly displayed in a web browser using the <code>&lt;video&gt;</code> element. Hence, here use <strong>WebGL</strong> to render the frames onto a <strong>Canvas</strong> element.</p><p>Here is an example code snippet that shows how to render a video using WebGL or WebGPU:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>WebGL Video Player<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    body <span class="token punctuation">{</span>
      margin: <span class="token number">0</span><span class="token punctuation">;</span>
      padding: <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    canvas <span class="token punctuation">{</span>
      width: <span class="token number">100</span>%<span class="token punctuation">;</span>
      height: <span class="token number">100</span>%<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>canvas <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;canvas&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/canvas<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">&quot;https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    var canvas <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    var gl <span class="token operator">=</span> canvas.getContext<span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    var video <span class="token operator">=</span> document.createElement<span class="token punctuation">(</span><span class="token string">&#39;video&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    video.crossOrigin <span class="token operator">=</span> <span class="token string">&#39;anonymous&#39;</span><span class="token punctuation">;</span>
    video.src <span class="token operator">=</span> <span class="token string">&#39;myvideo.mp4&#39;</span><span class="token punctuation">;</span>
    video.load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    video.play<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    var texture <span class="token operator">=</span> gl.createTexture<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    var program <span class="token operator">=</span> createShaderProgram<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    var buffer <span class="token operator">=</span> createBuffer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl.activeTexture<span class="token punctuation">(</span>gl.TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl.bindTexture<span class="token punctuation">(</span>gl.TEXTURE_2D, texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl.texParameteri<span class="token punctuation">(</span>gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl.texParameteri<span class="token punctuation">(</span>gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl.texParameteri<span class="token punctuation">(</span>gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl.texParameteri<span class="token punctuation">(</span>gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    var uTextureLocation <span class="token operator">=</span> gl.getUniformLocation<span class="token punctuation">(</span>program, <span class="token string">&#39;u_texture&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>video.readyState <span class="token operator">==</span><span class="token operator">=</span> video.HAVE_ENOUGH_DATA<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gl.texImage2D<span class="token punctuation">(</span>gl.TEXTURE_2D, <span class="token number">0</span>, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, video<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl.clear<span class="token punctuation">(</span>gl.COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl.useProgram<span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl.enableVertexAttribArray<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl.bindBuffer<span class="token punctuation">(</span>gl.ARRAY_BUFFER, buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl.vertexAttribPointer<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">2</span>, gl.FLOAT, false, <span class="token number">0</span>, <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl.uniform1i<span class="token punctuation">(</span>uTextureLocation, <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl.drawArrays<span class="token punctuation">(</span>gl.TRIANGLE_STRIP, <span class="token number">0</span>, <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      requestAnimationFrame<span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function-name function">createShaderProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      var vertexShader <span class="token operator">=</span> gl.createShader<span class="token punctuation">(</span>gl.VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
      var fragmentShader <span class="token operator">=</span> gl.createShader<span class="token punctuation">(</span>gl.FRAGMENT_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.shaderSource<span class="token punctuation">(</span>vertexShader, <span class="token variable"><span class="token variable">`</span>
        attribute vec2 a_position<span class="token punctuation">;</span>
        varying vec2 v_uv<span class="token punctuation">;</span>
        void <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          gl_Position <span class="token operator">=</span> vec4<span class="token punctuation">(</span>a_position, <span class="token number">0.0</span>, <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          v_uv <span class="token operator">=</span> <span class="token punctuation">(</span>a_position + <span class="token number">1.0</span><span class="token punctuation">)</span> / <span class="token number">2.0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.compileShader<span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.shaderSource<span class="token punctuation">(</span>fragmentShader, <span class="token variable"><span class="token variable">`</span>
        precision mediump float<span class="token punctuation">;</span>
        uniform sampler2D u_texture<span class="token punctuation">;</span>
        varying vec2 v_uv<span class="token punctuation">;</span>
        void <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          gl_FragColor <span class="token operator">=</span> texture2D<span class="token punctuation">(</span>u_texture, v_uv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.compileShader<span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      var program <span class="token operator">=</span> gl.createProgram<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.attachShader<span class="token punctuation">(</span>program, vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.attachShader<span class="token punctuation">(</span>program, fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.linkProgram<span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> program<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function-name function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      var buffer <span class="token operator">=</span> gl.createBuffer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.bindBuffer<span class="token punctuation">(</span>gl.ARRAY_BUFFER, buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl.bufferData<span class="token punctuation">(</span>gl.ARRAY_BUFFER, new Float32Array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="development-environment" tabindex="-1"><a class="header-anchor" href="#development-environment" aria-hidden="true">#</a> Development Environment</h2><p>Using <code>Emscription</code> as a compiler toolchain for building WebAssembly development/compilation environments.</p><h3 id="emscription" tabindex="-1"><a class="header-anchor" href="#emscription" aria-hidden="true">#</a> Emscription</h3><p><strong>Emscripten</strong> is an open-source toolchain for compiling C and C++ code into <code>WebAssembly</code>, <code>JavaScript</code>, and <code>asm.js</code>, which can be run on the web browser or other environments that support WebAssembly. Emscripten uses <code>LLVM</code> (Low-Level Virtual Machine) to compile C and C++ code into LLVM bitcode, which is then translated into WebAssembly or JavaScript using the Emscripten compiler.</p><p>The primary use case of Emscripten is to port existing C and C++ code to run on the web, enabling developers to take advantage of the high-performance characteristics of these languages in a web browser environment. Emscripten supports a wide range of C and C++ libraries and can also integrate with JavaScript code.</p><p>To use Emscripten, you will need to install the Emscripten SDK, which includes the Emscripten compiler and other tools, such as emrun, which can be used to run and debug WebAssembly applications. Once installed, you can compile your C or C++ code using the emcc command and run it in a web browser or other environments that support WebAssembly.</p><p>Emscripten also includes a set of optimization options that can be used to improve the performance of your WebAssembly code, such as the O3 optimization level, which enables aggressive optimization of the generated code.</p><p>Overall, Emscripten is a powerful tool for porting C and C++ code to run on the web, enabling developers to take advantage of the performance characteristics of these languages in a web browser environment.</p><h3 id="asm-js" tabindex="-1"><a class="header-anchor" href="#asm-js" aria-hidden="true">#</a> ASM.js</h3><p><strong>ASM.js</strong> was first introduced by Mozilla in 2013 as a way to improve the performance of web applications. At the time, web developers were struggling to create complex, high-performance applications that could compete with native applications running on desktops and mobile devices.</p><p>The original idea behind ASM.js was to provide a way to execute code written in other languages, like C and C++, in the browser. This was accomplished by creating a subset of JavaScript that was designed to be highly optimized and predictable, allowing it to be used as a target for other programming languages.</p><p>The development of ASM.js was driven by Mozilla&#39;s Emscripten project, which is a C and C++ to JavaScript compiler. Emscripten allows developers to take code written in these languages and compile it to ASM.js, which can then be executed in the browser without the need for plugins or additional software.</p><p>Over time, other browser vendors, including Google, Microsoft, and Apple, began to support ASM.js, and it became a widely accepted standard for high-performance web applications.</p><p>However, with the introduction of WebAssembly (WASM) in 2015, which is a low-level binary format for executing code in the browser, ASM.js has become less relevant. WASM provides a more efficient way to execute code, as it is designed specifically for this purpose and does not require the overhead of a JavaScript interpreter. Nonetheless, ASM.js remains a useful tool for developers who want to optimize their JavaScript code for performance.</p><h3 id="webassembly-vs-asm-js" tabindex="-1"><a class="header-anchor" href="#webassembly-vs-asm-js" aria-hidden="true">#</a> WebAssembly vs ASM.js</h3><p><strong>WebAssembly</strong> and <strong>ASM.js</strong> are both technologies that allow running code written in low-level programming languages like C, C++, or Rust in the browser. However, they differ in several ways:</p><ul><li><p>WebAssembly is a binary format that can be executed directly by the browser, while ASM.js is a subset of JavaScript that is designed to be executed efficiently by modern JavaScript engines.</p></li><li><p>WebAssembly is designed to be a platform-independent format that can be executed on different devices and architectures, while ASM.js is tied to the JavaScript environment.</p></li><li><p>WebAssembly offers better performance than ASM.js because it has a simpler, more efficient binary format and can be optimized more effectively by the browser.</p></li><li><p>WebAssembly offers more language support than ASM.js. While ASM.js is limited to C and C++, WebAssembly can be used with a wider range of languages, including Rust, Go, and even Java.</p></li><li><p>WebAssembly is a newer technology than ASM.js, and it has been designed to address some of the limitations of ASM.js, including its complexity and performance issues.</p></li></ul><p>Overall, while ASM.js was a significant improvement over traditional JavaScript for running low-level code in the browser, WebAssembly offers even better performance and flexibility, making it a more attractive option for many developers.</p><h3 id="compilation-tool" tabindex="-1"><a class="header-anchor" href="#compilation-tool" aria-hidden="true">#</a> Compilation Tool</h3><p><strong>WebAssembly compilation tools</strong> are used to convert code written in programming languages such as C/C++, Rust, AssemblyScript, and others, into WebAssembly bytecode that can be executed by modern web browsers and other environments that support WebAssembly.</p><p>There are several tools available for compiling code to WebAssembly, including:</p><ul><li><p><strong>Emscripten</strong> - a popular toolchain for compiling C/C++ code to WebAssembly. It uses LLVM to compile the code to intermediate representation (IR), and then translates the IR to WebAssembly using its own toolchain.</p></li><li><p><strong>AssemblyScript</strong> - a TypeScript-like language that compiles to WebAssembly. It provides a familiar syntax for developers who are familiar with TypeScript or JavaScript, and can be used to write high-performance code that can be executed in the browser or on the server.</p></li><li><p><strong>Rust</strong> - a programming language that was designed with performance and safety in mind. It has excellent support for WebAssembly, and can be compiled to WebAssembly using the Rust toolchain.</p></li><li><p><strong>Binaryen</strong> - a compiler and optimizer for WebAssembly that can be used to generate WebAssembly code from various programming languages. It is used by Emscripten and other WebAssembly tools to optimize and compress the generated code.</p></li><li><p><strong>wabt</strong> - a collection of tools for working with WebAssembly. It includes a binary toolkit that can be used to inspect and manipulate WebAssembly modules, as well as a text format toolkit that can be used to convert between the binary and text formats of WebAssembly.</p></li></ul><h3 id="source-code" tabindex="-1"><a class="header-anchor" href="#source-code" aria-hidden="true">#</a> Source Code</h3><h6 id="build-host-environment" tabindex="-1"><a class="header-anchor" href="#build-host-environment" aria-hidden="true">#</a> Build Host Environment</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> container run <span class="token parameter variable">-it</span> <span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 ubuntu
<span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span> xz-utils <span class="token function">bzip2</span> iputils-ping net-tools nginx cmake <span class="token function">git</span> python3.10
update-alternatives <span class="token parameter variable">--install</span> /usr/bin/python python /usr/bin/python3.10 <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="install-compilation-tool" tabindex="-1"><a class="header-anchor" href="#install-compilation-tool" aria-hidden="true">#</a> Install Compilation Tool</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> /home/wasm
<span class="token builtin class-name">cd</span> /home/wasm
<span class="token function">git</span> clone https://github.com/emscripten-core/emsdk.git
<span class="token builtin class-name">cd</span> emsdk
./emsdk <span class="token function">install</span> latest
./emsdk activate latest
<span class="token builtin class-name">source</span> ./emsdk_env.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="write-hello-world" tabindex="-1"><a class="header-anchor" href="#write-hello-world" aria-hidden="true">#</a> Write Hello World</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/emsdk/test
<span class="token builtin class-name">cd</span> /home/emsdk/test
<span class="token function">vi</span> hello.c
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>hello.c</p><div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="language-c++"><code>#include&lt;stdio.h&gt;
int main(int argc, char *argv[]) 
{
  printf(&quot;%s\n&quot;, &quot;hello world!&quot;);
  return 0;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>emcc</p><div class="language-plain" data-ext="plain"><pre class="language-plain"><code>emcc hello.c -o hello.html
</code></pre></div><p>emrun</p><div class="language-plain" data-ext="plain"><pre class="language-plain"><code>emrun --no_browser --port 8000 hello.html 
</code></pre></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>&quot;Hello World&quot; has been displayed on this link: <a href="http://localhost:8000/hello.html" target="_blank" rel="noopener noreferrer">http://localhost:8000/hello.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/2023/webAssembly/webAssemblyStepByStep.html" class="" aria-label="WebAssembly step-by-step"><!--[--><!--]--> WebAssembly step-by-step <!--[--><!--]--></a></span><span class="next"><a href="/2023/webAssembly/ts.html" class="" aria-label="TS (Transport Stream)"><!--[--><!--]--> TS (Transport Stream) <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/2023/assets/app-8d1f7407.js" defer></script>
  </body>
</html>
